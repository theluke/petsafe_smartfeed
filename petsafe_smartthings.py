import petsafe_smartfeed as sf
from aiohttp import ClientSession
import asyncio

# PetSafe credentials 
PETSAFE_EMAIL = "massavero@gmail.com"
PETSAFE_ID_TOKEN = "eyJraWQiOiI1M2xwRVZQcDA4eTZHbjdnWEZCR3BOaDdTSXZqbmdreWo3Wk1WUVJYcjFNPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJiNjVlNzEzNS0wMWY0LTQzNDItYTNiNC03MWY0ODk1Zjk5MzAiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsImFwcENsaWVudE5hbWUiOiJwZXRzYWZlIiwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tXC91cy1lYXN0LTFfeVZBa0NEeURjIiwiY29nbml0bzp1c2VybmFtZSI6ImI2NWU3MTM1LTAxZjQtNDM0Mi1hM2I0LTcxZjQ4OTVmOTkzMCIsInVzZXJJZCI6ImI2NWU3MTM1LTAxZjQtNDM0Mi1hM2I0LTcxZjQ4OTVmOTkzMCIsImF1ZCI6IjE4aHBwMDRwdXFtZ2Y1bmM2bzQ3NGxjcDJnIiwiZXZlbnRfaWQiOiI4Njc2YTI1Yi1hNjZkLTQyOGUtYTM5MS1mM2Q4ZTM2MWRjM2UiLCJ0b2tlbl91c2UiOiJpZCIsImF1dGhfdGltZSI6MTczOTYxOTI0OSwiZXhwIjoxNzM5NjIyODQ5LCJpYXQiOjE3Mzk2MTkyNDksImVtYWlsIjoibWFzc2F2ZXJvQGdtYWlsLmNvbSJ9.bPp2F_LS1uxiMFGvVgjDgoEZPHVvgAF7msuoi8Whi6twuALPlAHfFLuqT74qvsUibaKewoQn7rEBG1KqRpdKJchITiGY77t8aN4UAl5OrPW4DU3OWgD7sM_EEFvRbmFEYMrvyzHPQlQyx9tZMiVYpeNuM8scvZVBMiwpAf0bG1l0C-rbW2d5Lei18a7XfbxtfNtoIldOgRaMcZAYbp4Yi1VCrIOTccF8t-j7lb5L2NIQP7NxzEffdFUeaW8T-R18GvaEDxEwaU0yj6DPbozl_xXfySqWFrlgsVfzPZInX5BwRBw0_1vMCz9oUBcyV_Ks8ENqLasHaRQ86CpazDJmSQ"
PETSAFE_REFRESH_TOKEN = "eyJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAifQ.HkTgYWo6FPOMUyzvjfHDBj18hpVOxnROFmQNE0YcEjlctwZGbs85uG-hGyUjQTOMm2ZFkN6_NYXZRc11htJ8Blmz6B2-vGDNcL0aIi4TW4HWEjcaYj07_R2_J5fgsm2jrpNqa1o77yTTIduap0Hn-7Xy4jPn-GByD2yfwcr9Qmp0cZcV8LXkAVcrfVZgFCWSG5mdMLzF4ss2fkaQajWBrxgkMntgkKD7OWQj2W2fOXwgqsVQQAKsbkAMA6ar8IInbA0VSBs7MdROgfgki_na_UHT6_rO94R6smw9u33u21N216wtHQZBIbJOF66_0jPvGD9KjnM6i1PkWeS0HmTChw.GJYeieeGXOn3-DDv._yX64yqGqIwPjRpmk33Q_u6OczkGUB-KoVK9EApw09ag6qqPrt8ZG0fDueQillNe9OIafQwpaW_muzQc9OrDpQFuGuPqQFaC0TzvF2M_MB0zMsPIrcwoyhEHQynC32E3EsvFo-zNLiUI37UO9XfwZotg5f_tDVe19FHzSA1jtmXi-Dii6M2raBEQHAcbVqBK3wkXv-q456RhH4Jnd0lkovp1abrnJwQarSM_ruBCTpSExXnPmEdIHXvRkpkkn2E5C_snvLYxY4-tOOkFw25hVx64pf3bSWdRMBwiMnKAnaO3mYwNsZi-SjKAJ_UNKETY5AdkB8VFnoT6gsqaGTzIcI10f4OJEz3Zsu7Ej2w8PNo4uTidcRXLp3BySN-VjvlrKKB29hxYRrB5FyJEgTDWu9WxcXOyGKRSleWVpH8Q1EDixCqRXnGKPCh4Rwbh_rwyq4aOIj1VItVP3aISI2EVbMzdo0wNvKh91BKIJ_rUiWBFA-naHF6OcA79oksDM2OeIiZvjSJkgdmfwjtEY7syFpZ-VKlsCg39v7o2fx1gYW8OL7FmSgSR6Ti-aIVxslyAtxc9JblT00U2yncttDB7ZtloW6pm55KN3sN9xAVbA0WTQfy4LhvoierJz34yq8L07LxQKVdEFRnR5AdYLGvWc_Qt3PLBF6dBVqeCzGdkbx7dJSz8vZZxdxKrYXl4UqVALFQVPs4iXaBkGVaUy_PyzUQWiDB2j97QZMx5jitCcCKFdKXjaD0JUCdqQBwAlCuYpCVdnatqOsWaL-V7C8cXxrnPzPGKkyJFDjetsLb110xo2Qz0EhFC2BXYaAgZ13W2RXEDqiLl_tkumvzHYwp173PZhGyLooIDm033IXihFpVePUy6LrhN9Zbvk4qsZC0n9ZG5FAAjdVuSKUxXxq2z3SlYT24jJAEY2oT93Ej0dfqmwlEB9zRyYsTZu_YcLsX1Ps6jVL4QjMnX1-OYHZtHdtllB9kEUCUfsPvxIXeQX4x9CDxX_DbqkN9dRc3fjYxiJuX7MgEalcmF4OGRKrfLqfKkt8GJrWsJ3V44CvptG6B2vNvg8MhHtL9PCI57O0CB2GCLW_GeNTqCAZqG38nT8YPPl7JjdsOj0Q3ZpuI-5D1yffxVkaT-TGs67H4nELXu0dPYQJtzM0P7GmhZKN1pr1gPuw239IdimtG4tX1Zu0REjFJlmRpnHpuNQpqKP5Px7zoez0H5Rggium0Shy45V_hGweAs4fddOXDQTYJyJY1fugmbsDB5DM-p9NwsMsruiVGbZmcI7lsiyqZdnuO7BGW36movCcH2DsSwZRRHcyiNniVBJTnulS1xqWQjMw.wChlSuIv376kQCG-fdd9BQ" 
PETSAFE_ACCESS_TOKEN = "eyJraWQiOiJsWEM4aWRZemRoVkQxQ1Bma0V0eUh6OE0wMUdWSFFuQUZrVnhxenkwN1M0PSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJiNjVlNzEzNS0wMWY0LTQzNDItYTNiNC03MWY0ODk1Zjk5MzAiLCJldmVudF9pZCI6Ijg2NzZhMjViLWE2NmQtNDI4ZS1hMzkxLWYzZDhlMzYxZGMzZSIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4iLCJhdXRoX3RpbWUiOjE3Mzk2MTkyNDksImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbVwvdXMtZWFzdC0xX3lWQWtDRHlEYyIsImV4cCI6MTczOTYyMjg0OSwiaWF0IjoxNzM5NjE5MjQ5LCJqdGkiOiI2ZDM5MTgyNC1hYzY2LTQxMmUtYWY4MS1jMjJjZjgyZTRiOTIiLCJjbGllbnRfaWQiOiIxOGhwcDA0cHVxbWdmNW5jNm80NzRsY3AyZyIsInVzZXJuYW1lIjoiYjY1ZTcxMzUtMDFmNC00MzQyLWEzYjQtNzFmNDg5NWY5OTMwIn0.CO3kXGcwR7y8kZSfeL7yrSr16hFUb-qcvpaqYJo2FUn3gy4qvx5thvpmGgJrS8lHI2zsb_QXLBFg-rrwQF6GHRhFeLeY8lKecDjkdR_CE0zhFqSQC7fbm0vXW84gJ2gRzmQtyTB4UojfXrJqm5TVk52BOtGe3D61QFJE5BODrtiX7yf22ev7eBzBLrO2V7vW0IYK_PaDuHLPPqGT4lwKSUwqT1yIlSWlX9Pu59pEFCuq-dQ7lYSuL4EbgR7VwcdQLsx0noh56CO0iDGjJXNZLT3v8QxkN144ilkRtixflughJHRctnWKx_x4_OSToW9HctaWXD0l6gdHEebLG3QlWw"

# SmartThings token
SMARTTHINGS_TOKEN = "9032464b-5ecf-44c9-a033-f56a7e9fa73e"
SMARTTHINGS_API = "https://api.smartthings.com/v1"

async def update_smartthings(battery, food_status):
    async with ClientSession() as session:
        headers = {"Authorization": f"Bearer {SMARTTHINGS_TOKEN}"}
        data = {
            "battery": battery,
            "foodLevel": food_status
        }
        await session.post(f"{SMARTTHINGS_API}/devices/status", headers=headers, json=data)

def monitor_feeder():
    client = sf.PetSafeClient(
        email=PETSAFE_EMAIL,
        id_token=PETSAFE_ID_TOKEN,
        refresh_token=PETSAFE_REFRESH_TOKEN,
        access_token=PETSAFE_ACCESS_TOKEN
    )
    
    feeder = client.feeders[0]
    battery = feeder.battery_level
    food_status = feeder.food_low_status
    
    asyncio.run(update_smartthings(battery, food_status))

if __name__ == "__main__":
    monitor_feeder()
